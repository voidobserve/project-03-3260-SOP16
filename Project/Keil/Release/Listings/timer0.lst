C51 COMPILER V9.60.7.0   TIMER0                                                            07/10/2025 11:57:32 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TIMER0
OBJECT MODULE PLACED IN .\Release\Objects\timer0.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\timer0.c LARGE OPTIMIZE(9,SIZE) BROWSE INTVECTOR(0X000C) INCD
                    -IR(..\..\Libraries\Include;..\..\User;..\..\User\lib) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\timer0.lst
                    -) OBJECT(.\Release\Objects\timer0.obj)

line level    source

   1          #include "timer0.h"
   2          #include "my_config.h"
   3          #include "rf_recv.h"
   4          
   5          // Ëß¶Êë∏ÊåâÈîÆÊ®°ÂùóÂàùÂßãÂåñÁöÑÂÄíËÆ°Êó∂
   6          static volatile u32 touch_init_cnt = 0;
   7          
   8          volatile bit flag_is_reinitialize_touch = 0; // ÊòØÂê¶ÈúÄË¶ÅÈáçÊñ∞ÂàùÂßãÂåñËß¶Êë∏ÊåâÈîÆ
   9          
  10          // Ê∏ÖÈõ∂Ëß¶Êë∏ÊåâÈîÆÊ®°ÂùóÂàùÂßãÂåñÁöÑÂÄíËÆ°Êó∂
  11          void touch_cnt_down_clear(void)
  12          {
  13   1          touch_init_cnt = 0;
  14   1          flag_is_reinitialize_touch = 0;
  15   1      }
  16          
  17          /**
  18           * @brief ÈÖçÁΩÆÂÆöÊó∂Âô®TMR0ÔºåÂÆöÊó∂Âô®ÈªòËÆ§ÂÖ≥Èó≠
  19           */
  20          void timer0_config(void)
  21          {
  22   1          __EnableIRQ(TMR0_IRQn); // ‰ΩøËÉΩtimer0‰∏≠Êñ≠
  23   1          IE_EA = 1;              // ‰ΩøËÉΩÊÄª‰∏≠Êñ≠
  24   1      
  25   1      #define PEROID_VAL (SYSCLK / 1 / 10000 - 1) // Âë®ÊúüÂÄº=Á≥ªÁªüÊó∂Èíü/ÂàÜÈ¢ë/È¢ëÁéá - 1
  26   1      
  27   1          TMR_ALLCON = TMR0_CNT_CLR(0x1);                        // Ê∏ÖÈô§ËÆ°Êï∞ÂÄº
  28   1          TMR0_PRH = TMR_PERIOD_VAL_H((PEROID_VAL >> 8) & 0xFF); // Âë®ÊúüÂÄº
  29   1          TMR0_PRL = TMR_PERIOD_VAL_L((PEROID_VAL >> 0) & 0xFF);
  30   1          TMR0_CONH = TMR_PRD_PND(0x1) | TMR_PRD_IRQ_EN(0x1);                           // ËÆ°Êï∞Á≠â‰∫éÂë®ÊúüÊó∂
             -ÂÖÅËÆ∏ÂèëÁîü‰∏≠Êñ≠
  31   1          TMR0_CONL = TMR_SOURCE_SEL(0x7) | TMR_PRESCALE_SEL(0x00) | TMR_MODE_SEL(0x1); // ÈÄâÊã©Á≥ªÁªüÊó∂ÈíüÔºå
             -1ÂàÜÈ¢ëÔºåËÆ°Êï∞Ê®°Âºè
  32   1      }
  33          
  34          // TMR0‰∏≠Êñ≠ÊúçÂä°ÂáΩÊï∞
  35          void TIMR0_IRQHandler(void) interrupt TMR0_IRQn
  36          {
  37   1          // ËøõÂÖ•‰∏≠Êñ≠ËÆæÁΩÆIPÔºå‰∏çÂèØÂà†Èô§
  38   1          __IRQnIPnPush(TMR0_IRQn);
  39   1      
  40   1          // ---------------- Áî®Êà∑ÂáΩÊï∞Â§ÑÁêÜ -------------------
  41   1      
  42   1          // Âë®Êúü‰∏≠Êñ≠
  43   1          if (TMR0_CONH & TMR_PRD_PND(0x1))
  44   1          {
  45   2              TMR0_CONH |= TMR_PRD_PND(0x1); // Ê∏ÖÈô§pending
  46   2      
  47   2      #if 1 // rf‰ø°Âè∑Êé•Êî∂ Ôºà100usË∞ÉÁî®‰∏ÄÊ¨°Ôºâ
  48   2              {
  49   3                  static volatile u8 rf_bit_cnt;            // RF‰ø°Âè∑Êé•Êî∂ÁöÑÊï∞ÊçÆ‰ΩçËÆ°Êï∞ÂÄº
  50   3                  static volatile u32 __rf_data;            // ÂÆöÊó∂Âô®‰∏≠Êñ≠‰ΩøÁî®ÁöÑÊé•Êî∂ÁºìÂÜ≤Âå∫ÔºåÈÅøÂÖçÁ
             -õ¥Êé•Ë¶ÜÁõñÂÖ®Â±ÄÁöÑÊï∞ÊçÆÊé•Êî∂ÁºìÂÜ≤Âå∫
C51 COMPILER V9.60.7.0   TIMER0                                                            07/10/2025 11:57:32 PAGE 2   

  51   3                  static volatile u8 flag_is_enable_recv;   // ÊòØÂê¶‰ΩøËÉΩÊé•Êî∂ÁöÑÊ†áÂøó‰ΩçÔºåË¶ÅÊé•Êî∂Âà∞ 5ms
             -+ ÁöÑ‰ΩéÁîµÂπ≥ÊâçÂºÄÂßãÊé•Êî∂
  52   3                  static volatile u8 __flag_is_recved_data; // Ë°®Á§∫‰∏≠Êñ≠ÊúçÂä°ÂáΩÊï∞Êé•Êî∂Âà∞‰∫ÜrfÊï∞ÊçÆ
  53   3      
  54   3                  static volatile u8 low_level_cnt;  // RF‰ø°Âè∑‰ΩéÁîµÂπ≥ËÆ°Êï∞ÂÄº
  55   3                  static volatile u8 high_level_cnt; // RF‰ø°Âè∑È´òÁîµÂπ≥ËÆ°Êï∞ÂÄº
  56   3      
  57   3                  // Âú®ÂÆöÊó∂Âô® ‰∏≠Êâ´ÊèèÁ´ØÂè£ÁîµÂπ≥
  58   3                  if (0 == RFIN_PIN)
  59   3                  {
  60   4                      // Â¶ÇÊûúRFÊé•Êî∂ÂºïËÑö‰∏∫‰ΩéÁîµÂπ≥ÔºåËÆ∞ÂΩï‰ΩéÁîµÂπ≥ÁöÑÊåÅÁª≠Êó∂Èó¥
  61   4                      low_level_cnt++;
  62   4      
  63   4                      /*
  64   4                          ‰∏ãÈù¢ÁöÑÂà§Êñ≠Êù°‰ª∂ÊòØÈÅøÂÖçÈÉ®ÂàÜÈÅ•ÊéßÂô®ÊàñÊé•Êî∂Ê®°ÂùóÂè™ÂèëÈÄÅ24‰ΩçÊï∞ÊçÆÔºåÊúÄ
             -Âêé‰∏çÊãâÈ´òÁîµÂπ≥ÁöÑÊÉÖÂÜµ
  65   4                      */
  66   4                      if (low_level_cnt >= 30 && rf_bit_cnt == 23) // Â¶ÇÊûú‰ΩéÁîµÂπ≥Â§ß‰∫é3000usÔºåÂπ∂‰∏îÂ∑≤Áªè
             -Êé•Êî∂‰∫Ü23‰ΩçÊï∞ÊçÆ
  67   4                      {
  68   5                          if (high_level_cnt >= 6 && high_level_cnt < 20)
  69   5                          {
  70   6                              __rf_data |= 0x01;
  71   6                          }
  72   5                          else if (high_level_cnt >= 1 && high_level_cnt < 6)
  73   5                          {
  74   6                          }
  75   5      
  76   5                          __flag_is_recved_data = 1; // Êé•Êî∂ÂÆåÊàêÊ†áÂøó‰ΩçÁΩÆ‰∏Ä
  77   5                          flag_is_enable_recv = 0;
  78   5                      }
  79   4                  }
  80   3                  else
  81   3                  {
  82   4                      if (low_level_cnt > 0)
  83   4                      {
  84   5                          // Â¶ÇÊûú‰πãÂâçÊé•Êî∂Âà∞‰∫Ü‰ΩéÁîµÂπ≥‰ø°Âè∑ÔºåÁé∞Âú®ÈÅáÂà∞‰∫ÜÈ´òÁîµÂπ≥ÔºåÂà§Êñ≠ÊòØÂê¶Êé
             -•Êî∂ÂÆåÊàê‰∫Ü‰∏Ä‰ΩçÊï∞ÊçÆ
  85   5                          if (low_level_cnt > 50)
  86   5                          {
  87   6                              // Â¶ÇÊûú‰ΩéÁîµÂπ≥ÊåÅÁª≠Êó∂Èó¥Â§ß‰∫é50 * 100usÔºà5msÔºâÔºåÂáÜÂ§á‰∏ã‰∏ÄÊ¨°ÂÜçËØªÂèñ
             -ÊúâÊïà‰ø°Âè∑
  88   6                              __rf_data = 0;  // Ê∏ÖÈô§Êé•Êî∂ÁöÑÊï∞ÊçÆÂ∏ß
  89   6                              rf_bit_cnt = 0; // Ê∏ÖÈô§Áî®Êù•ËÆ∞ÂΩïÊé•Êî∂ÁöÑÊï∞ÊçÆ‰ΩçÊï∞
  90   6      
  91   6                              flag_is_enable_recv = 1;
  92   6                          }
  93   5                          else if (flag_is_enable_recv &&
  94   5                                   low_level_cnt >= 2 && low_level_cnt < 7 &&
  95   5                                   high_level_cnt >= 6 && high_level_cnt < 20)
  96   5                          {
  97   6                              // Â¶ÇÊûú‰ΩéÁîµÂπ≥ÊåÅÁª≠Êó∂Èó¥Âú®360usÂ∑¶Âè≥ÔºåÈ´òÁîµÂπ≥ÊåÅÁª≠Êó∂Èó¥Âú®760usÂ∑¶Âè≥
             -ÔºåËØ¥ÊòéÊé•Êî∂Âà∞‰∫Ü1
  98   6                              __rf_data |= 0x01;
  99   6                              rf_bit_cnt++;
 100   6                              if (rf_bit_cnt != 24)
 101   6                              {
 102   7                                  __rf_data <<= 1; // Áî®‰∫éÂ≠òÊîæÊé•Êî∂24‰ΩçÊï∞ÊçÆÁöÑÂèòÈáèÂ∑¶Áßª‰∏Ä‰Ωç
 103   7                              }
 104   6                          }
 105   5                          else if (flag_is_enable_recv &&
 106   5                                   low_level_cnt >= 7 && low_level_cnt < 20 &&
C51 COMPILER V9.60.7.0   TIMER0                                                            07/10/2025 11:57:32 PAGE 3   

 107   5                                   high_level_cnt >= 1 && high_level_cnt < 6)
 108   5                          {
 109   6                              // Â¶ÇÊûú‰ΩéÁîµÂπ≥ÊåÅÁª≠Êó∂Èó¥Âú®840usÂ∑¶Âè≥ÔºåÈ´òÁîµÂπ≥ÊåÅÁª≠Êó∂Èó¥Âú®360usÂ∑¶Âè≥
             -ÔºåËØ¥ÊòéÊé•Êî∂Âà∞‰∫Ü0
 110   6                              __rf_data &= ~1;
 111   6                              rf_bit_cnt++;
 112   6                              if (rf_bit_cnt != 24)
 113   6                              {
 114   7                                  __rf_data <<= 1; // Áî®‰∫éÂ≠òÊîæÊé•Êî∂24‰ΩçÊï∞ÊçÆÁöÑÂèòÈáèÂ∑¶Áßª‰∏Ä‰Ωç
 115   7                              }
 116   6                          }
 117   5                          else
 118   5                          {
 119   6                              // Â¶ÇÊûú‰ΩéÁîµÂπ≥ÊåÅÁª≠Êó∂Èó¥‰∏çÁ¨¶Âêà0Âíå1ÁöÑÂà§Êñ≠Êù°‰ª∂ÔºåËØ¥ÊòéÊ≠§Êó∂Ê≤°ÊúâÊé
             -•Êî∂Âà∞‰ø°Âè∑
 120   6                              __rf_data = 0;
 121   6                              rf_bit_cnt = 0;
 122   6                              flag_is_enable_recv = 0;
 123   6                          }
 124   5      
 125   5                          low_level_cnt = 0; // Êó†ËÆ∫ÊòØÂê¶Êé•Êî∂Âà∞‰∏Ä‰ΩçÊï∞ÊçÆÔºåÈÅáÂà∞È´òÁîµÂπ≥Êó∂ÔºåÂÖàÊ∏ÖÈ
             -ô§‰πãÂâçÁöÑËÆ°Êï∞ÂÄº
 126   5                          high_level_cnt = 0;
 127   5      
 128   5                          if (24 == rf_bit_cnt)
 129   5                          {
 130   6                              // Â¶ÇÊûúÊé•Êî∂Êàê‰∫Ü24‰ΩçÁöÑÊï∞ÊçÆ
 131   6                              __flag_is_recved_data = 1; // Êé•Êî∂ÂÆåÊàêÊ†áÂøó‰ΩçÁΩÆ‰∏Ä
 132   6                              flag_is_enable_recv = 0;
 133   6                          }
 134   5                      }
 135   4                      else
 136   4                      {
 137   5                          // Â¶ÇÊûúÊé•Êî∂Âà∞È´òÁîµÂπ≥ÂêéÔºå‰ΩéÁîµÂπ≥ÁöÑËÆ°Êï∞‰∏∫0
 138   5      
 139   5                          if (0 == flag_is_enable_recv)
 140   5                          {
 141   6                              __rf_data = 0;
 142   6                              rf_bit_cnt = 0;
 143   6                              flag_is_enable_recv = 0;
 144   6                          }
 145   5                      }
 146   4      
 147   4                      // Â¶ÇÊûúRFÊé•Êî∂ÂºïËÑö‰∏∫È´òÁîµÂπ≥ÔºåËÆ∞ÂΩïÈ´òÁîµÂπ≥ÁöÑÊåÅÁª≠Êó∂Èó¥
 148   4                      high_level_cnt++;
 149   4                  }
 150   3      
 151   3                  if (__flag_is_recved_data) //
 152   3                  {
 153   4                      rf_bit_cnt = 0;
 154   4                      __flag_is_recved_data = 0;
 155   4                      low_level_cnt = 0;
 156   4                      high_level_cnt = 0;
 157   4      
 158   4                      // if (rf_data != 0)
 159   4                      // if (0 == flag_is_recved_rf_data) /* Â¶ÇÊûú‰πãÂâçÊú™Êé•Êî∂Âà∞Êï∞ÊçÆ ÊàñÊòØ Â∑≤ÁªèÂ§ÑÁêÜÂ
             -Æå‰∏ä‰∏ÄÊ¨°Êé•Êî∂Âà∞ÁöÑÊï∞ÊçÆ */
 160   4                      {
 161   5                          // Áé∞Âú®Êîπ‰∏∫Âè™Ë¶ÅÊî∂Âà∞Êñ∞ÁöÑÊï∞ÊçÆÔºåÂ∞±Ë¶ÜÁõñrf_data
 162   5                          rf_data = __rf_data;
 163   5                          recv_rf_flag = 1;
 164   5                      }
C51 COMPILER V9.60.7.0   TIMER0                                                            07/10/2025 11:57:32 PAGE 4   

 165   4                      // else
 166   4                      // {
 167   4                      //     __rf_data = 0;
 168   4                      // }
 169   4                  }
 170   3              }
 171   2      #endif // rf‰ø°Âè∑Êé•Êî∂ Ôºà100usË∞ÉÁî®‰∏ÄÊ¨°Ôºâ
 172   2      
 173   2              {
 174   3                  static u8 cnt = 0;
 175   3                  cnt++;
 176   3                  if (cnt >= 10) // 10 * 100usÔºå1msËøõÂÖ•‰∏ÄÊ¨°
 177   3                  {
 178   4                      cnt = 0;
 179   4      
 180   4                      if (touch_init_cnt < 4294967296 - 1) // Èò≤Ê≠¢ËÆ°Êï∞Ê∫¢Âá∫ Ôºà2^32Ôºâ
 181   4                      {
 182   5                          touch_init_cnt++;
 183   5      
 184   5                          if (touch_init_cnt >= 5000)
 185   5                          {
 186   6                              touch_init_cnt = 0;
 187   6                              flag_is_reinitialize_touch = 1;
 188   6      
 189   6                              // P15 = ~P15; // ÊµãËØïÁî®
 190   6                          }
 191   5                      }
 192   4                  }
 193   3              }
 194   2          }
 195   1      
 196   1          // ÈÄÄÂá∫‰∏≠Êñ≠ËÆæÁΩÆIPÔºå‰∏çÂèØÂà†Èô§
 197   1          __IRQnIPnPop(TMR0_IRQn);
 198   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    543    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     14    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
